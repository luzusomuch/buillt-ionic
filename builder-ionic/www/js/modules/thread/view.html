<ion-view title='{{thread.name}}'>
    <ion-nav-back-button ng-click="$ionicGoBack($event)" class="button-icon icon ion-ios7-arrow-back">Back</ion-nav-back-button>
	
    <div class="bar bar-subheader">
		
        <form class="ng-pristine ng-valid" name="messageForm" novalidate ng-submit="sendMessage()" style="margin-top: 10px;">
            <div class="item item-input">
                <textarea style="width:80%" name="text" id="textarea1" placeholder="Send a message ..." ng-model="message.text">
                </textarea>
                <button class="button button-stable button-block" type="submit" style="width:20%; margin-right:10px;" name="action">Send
                    <i class="mdi-content-send right"></i>
                </button>
            </div>
        </form>
		
    </div>
	
    <ion-content padding="false" class="has-header has-subheader">
        <div class="space" style="height:50px"></div>
        <div id="thread-detail-content">
            <ul class="list">
                <li class="item item-divider">Thread Name:</li>
                <li class="item">{{thread.name}}</li>

                <li class="item item-divider">Thread Assignees:</li>
                <li class="item">
                    <ul style="margin-left: 20px;">
                        <li ng-repeat="member in thread.members | unique: '_id'" style="margin-top: 10px;">{{member.name}}</li>
                        <li ng-repeat="email in thread.notMembers" style="margin-top: 10px;">{{email}} </li>
                    </ul>
                </li>

                <li class="item item-divider">Thread Activities</li>
                <li class="item">
                    <div class="list">
                        <ion-item class="item-text-warp">
                            <p>
                                <span>{{(thread.owner._id==currentUser._id) ? "You" : thread.owner.name}} created this thread on <strong>{{thread.createdAt | date: longDate}}</strong>.</span>
                            </p>
                        </ion-item>
                        <ion-item class="item-text-wrap" ng-repeat="activity in thread.activities">
                            <p ng-switch="activity.type">
                                <span>{{(activity.user._id==currentUser._id) ? "You" : activity.user.name}} </span>

                                <span ng-switch-when="chat">sent reply "<span ng-bind-html="activity.element.message | htmlize"></span>" at <strong>{{activity.createdAt | date:'hh:mm a'}}, {{activity.createdAt |date:'dd-MM-yyyy'}}</strong>.</span>

                                <span ng-switch-when="assign"> assigned the following people :<span ng-repeat="member in activity.element.invitees"><strong>{{member}}</strong>, </span> to this task at <strong>{{activity.createdAt | date:'hh:mm a'}}, {{activity.createdAt |date:'dd-MM-yyyy'}}</strong>.</span>

                                <span ng-switch-when="insert-note"> added a note with content: <strong>{{activity.element.content}}</strong> to this task at <strong>{{activity.createdAt | date:'hh:mm a'}}, {{activity.createdAt |date:'dd-MM-yyyy'}}</strong></span>

                                <span ng-switch-when="archive"> archived this thread at <strong>{{activity.createdAt | date:'hh:mm a'}}, {{activity.createdAt |date:'dd-MM-yyyy'}}</strong>.</span>

                                <span ng-switch-when="unarchive"> unarchived this thread at <strong>{{activity.createdAt | date:'hh:mm a'}}, {{activity.createdAt |date:'dd-MM-yyyy'}}</strong>.</span>
                            </p>
                        </ion-item>
                    </div>
                </li>
            </ul>
        </div>

        <div class="space" style="height:50px"></div>
    </ion-content>

	<div class="bar bar-footer bar-calm">
	  <div class="title">Send a Message</div>
	</div>
	
</ion-view>

<script id="sendMessageDialog.html" type="text/ng-template">
    <div class="modal">
		
		<!-- Header -->
        <ion-header-bar class="bar-light">
            <h1 class="title">Send a Message...</h1>
            <div class="buttons">
                <button ng-click="closeModal('CreateThread')" class="button button-stable button-icon icon ion-ios-close-empty"></button>
            </div>
        </ion-header-bar>
		
		<!-- Thread Name and Assignees -->
        <ion-content padding="true" class="has-header">
			
            <form ng-show="selectedProject._id" style="" id="createThreadForm" name="form" novalidate ng-submit="createNewThread(form)">

                <div class="item item-input item-floating-label">
					<span class="input-label">Message Body</span>
                    <input placeholder="Subject Name" id="thread_name" type="text" ng-model="thread.name" required name="name" ng-class="{'invalid' : form.name.$invalid && submitted}">
                    <p class="validate-message" style="color: #F44336" ng-show="form.name.$error.required && submitted">Your message body is required...</p>
                </div>
				
            </form>
        </ion-content>
		
		<div class="bar bar-footer bar-calm">
		  <div class="title">Send Message</div>
		</div>
		
    </div>
</script>