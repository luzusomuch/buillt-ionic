<ion-view>
    <!-- <ion-nav-back-button ng-click="$ionicGoBack($event)" class="button-icon icon ion-ios7-arrow-left"> Back</ion-nav-back-button> -->

    <ion-nav-title>
      {{file.name}}
    </ion-nav-title>

    <!-- show upload reversion modal -->
    <ion-nav-buttons side="right" ng-show="file.owner._id==currentUser._id">
        <button ng-click="showModalEditFile()" class="button button-clear" style="margin-right: 10px; font-size: 15px">Edit</button> 
    </ion-nav-buttons>

    <ion-content class="has-header file-content has-footer">
	
        <div class="space" style="margin-top: 20px;"></div>
		
        <div id="file-detail-content">
            <div class="item-text-wrap">
                <div class="activity-item">
					
                    <div class="activity-header">
                        <span class="activity-creator"><strong>{{(file.owner._id==currentUser._id) ? "You" : file.owner.name}}</strong></span>
                        <small> created this file on {{file.createdAt | date : 'dd MMMM yyyy'}}</small>
                    </div>
					
                </div>
            </div>

            <div class="item-text-wrap" ng-repeat="activity in file.activities" ng-show="activity.type=='upload-reversion' || activity.type=='related-thread' || activity.type=='related-task'">
                
                <div class="activity-item">
            
                    <div class="activity-header">
                        <span class="activity-creator"><strong>{{(activity.user._id==currentUser._id) ? "You" : activity.user.name}}</strong></span>
                
                        <small ng-switch="activity.type">
                            <span ng-switch-when="upload-reversion"> uploaded a new version of this file at {{activity.createdAt | date:'hh:mm a'}}, {{activity.createdAt |date:'dd MMMM yyyy'}}.</span>
                            <span ng-switch-when="related-thread"> attached a related thread at {{activity.createdAt | date:'hh:mm a'}}, {{activity.createdAt |date:'dd MMMM yyyy'}}.</span>
                            <span ng-switch-when="related-task"> attached a related task at {{activity.createdAt | date:'hh:mm a'}}, {{activity.createdAt |date:'dd MMMM yyyy'}}.</span>
                        </small>
                    </div>

                    <div class="activity-body" ng-switch="activity.type">
                        <span ng-switch-when="upload-reversion">
                            <img ng-show="activity.type=='upload-reversion'" file-picker-thumbnail url="{{activity.element.link}}" src="" alt="" style="width: 100%; height: auto">
                        </span>

                        <span ng-switch-when="related-thread">
                            "<a ui-sref="threadDetail({threadId: activity.element.item})">{{activity.element.name}}</a>"
                        </span>

                        <span ng-switch-when="related-task">
                            "<a ui-sref="taskDetail({taskDetail: activity.element.item})">{{activity.element.name}}</a>"
                        </span>
                    </div>
                    
                </div>
            </div>
        </div>

        <div class="space" style="margin-top: 20px;"></div>

    </ion-content>
	
    <div class="bar bar-footer bar-light">
		<div class="row">
			<i ng-click="modalCreateRelatedThread.show()" class="icon calm ion-ios-chatbubble-outline" style="margin-left: 20px; font-size: 24px;"></i>
            <i ng-click="modalCreateRelatedTask.show()" class="icon calm ion-ios-checkmark-outline" style="margin-left: 20px; font-size: 24px;"></i>
			<div class="col"></div>
			<button class="button button-clear button-calm" ng-click="openUploadReversion()" style="margin-top: -6px; margin-right: 10px; font-size: 15px">Attach New Version</button>
		</div>
    </div>
</ion-view>

<script id="modalCreateRelatedThread.html" type="text/ng-template">
    <div class="modal">
        <!-- Header -->
        <ion-header-bar class="bar-light">
            <h1 class="title">Create a New Related Thread...</h1>
            <div class="buttons">
                <button ng-click="modalCreateRelatedThread.hide()" class="button button-stable button-icon icon ion-ios-close-empty"></button>
            </div>
        </ion-header-bar>

        <ion-content class="has-header">
        
            <form ng-submit="createRelatedThread(form)" name="form" novalidate>
                
                <!-- Task Description -->
                
                <div class="item item-input item-floating-label">
                    <span class="input-label">Thread Name</span>
                    <input placeholder="Thread Name" id="name" type="text" ng-model="thread.name" name="name" maxlength="300" required>
                </div>

                <div class="item item-input item-floating-label">
                    <span class="input-label">Thread Message</span>
                    <textarea name="text" id="textarea1" placeholder="Your message ..." ng-model="thread.message" ng-keyup="expandText()" ng-keydown="expandText()"></textarea>
                </div>

                <div class="space" style="height: 50px"></div>

                <div>
                    <button style="width:100%" type="submit" class="button button-calm">Create Related Thread</button>
                </div>
            </form>
        </ion-content>
    </div>
</script>

<script id="modalCreateRelatedTask.html" type="text/ng-template">
    <div class="modal">
        <!-- Header -->
        <ion-header-bar class="bar-light">
            <h1 class="title">Create a New Related Task...</h1>
            <div class="buttons">
                <button ng-click="modalCreateRelatedTask.hide()" class="button button-stable button-icon icon ion-ios-close-empty"></button>
            </div>
        </ion-header-bar>
        
        <!-- Description and Assignee -->
        <ion-content class="has-header">
        
            <form ng-submit="createRelatedTask(form)" name="form" novalidate>
                
                <!-- Task Description -->
                
                <div class="item item-input item-floating-label" ng-show="step==1">
                    <span class="input-label">Task Description</span>
                    <input placeholder="Task Description" id="task_description" type="text" ng-model="task.description" name="description" maxlength="300" ng-class="{'invalid' : form.description.$invalid && submitted}" required>
                    <p class="validate-message" style="color: #F44336" ng-show="form.description.$error.required && submitted">A description is required...</p>
                </div>

                <div class="item" ng-show="step==2">
                    <span>Task Start Date Time</span>
                    <div ion-datetime-picker ng-model="task.dateStart"> {{task.dateStart| date: "dd MMMM yyyy H:mm"}} </div>
                </div>

                <div class="item" ng-show="step==2">
                    <span>Task End Date Time</span>
                    <div ion-datetime-picker ng-model="task.dateEnd"> {{task.dateEnd| date: "dd MMMM yyyy H:mm"}} </div>
                </div>

                <div class="space" style="height: 50px"></div>

                <div class="row">
                    <button type="button" class="col button" ng-click="step=step-1" ng-show="step!=1">Back</button>
                    <button type="button" class="col button" ng-click="next()" ng-hide="step==2">Next</button>
                    <button type="submit" ng-show="step==2" class="col button button-calm">Create Related Task</button>
                </div>
            </form>
        </ion-content>
    </div>
</script>

<script id="modalEditFile.html" type="text/ng-template">
    <div class="modal">
        <!-- Header -->
        <ion-header-bar class="bar-light">
            <h1 class="title">Edit File {{file.name}}</h1>
            <div class="buttons">
                <button ng-click="modalEditFile.hide()" class="button button-stable button-icon icon ion-ios-close-empty"></button>
            </div>
        </ion-header-bar>
        
        <!-- Thread Name and Assignees -->
        <ion-content padding="true" class="has-header">
            
            <form ng-submit="editFile(form)" name="form" novalidate>
                
                <div class="item item-input item-floating-label">
                    <span class="input-label">File Name</span>
                    <input placeholder="File Name" id="name" type="text" ng-model="file.name" required name="name">
                </div>

                <div class="list">
                    <label class="item item-input item-select">
                        <div class="input-label">Event</div>
                        <select ng-model="file.selectedEvent">
                            <option ng-selected="file.selectedEvent==ev._id" ng-repeat="ev in events" ng-value="ev._id">{{ev.name}}</option>
                        </select>
                    </label>
                </div>

                <div class="list">
                    <label class="item item-input item-select">
                        <div class="input-label">Tag</div>
                        <select ng-model="file.selectedTag">
                            <option ng-selected="file.selectedTag==tag.name" ng-repeat="tag in tags" ng-value="tag.name">{{tag.name}}</option>
                        </select>
                    </label>
                </div>

                <div>
                    <label class="item item-input item-stacked-label">
                        <span class="input-label">Assignees:</span>
                    </label>
                    <ion-list>
                        <ion-checkbox class="item item-checkbox checkbox-calm" ng-repeat="member in membersList track by $index" ng-click="chooseMember($index)">{{(member.name) ? member.name : member.email}}</ion-checkbox>
                    </ion-list>
                </div>

                <div>
                    <button style="width: 100%" type="submit" class="button button-calm">Save</button>
                </div>

                <div class="space" style="height: 50px">
                </div>
            </form>
        </ion-content>
    </div>
</script>

<script id="modalCreateDocument.html" type="text/ng-template">
    <div class="modal">
        <ion-header-bar class="bar-light">
            <h1 class="title">Upload File Reversion...</h1>
            <div class="buttons">
                <button ng-click="closeModal()" class="button button-stable button-icon icon icon ion-ios-close-empty"></button>
            </div>
        </ion-header-bar>
        <ion-content padding="true" class="has-header">
            <form ng-submit="uploadReversion()" name="uploadForm">
                <div class="spacer" style="display: inline-block; width: 300px; height: 50px;"></div>

                <div class="item item-input">
                    <input onchange="angular.element(this).scope().getFileUpload()" id="read-input" type="file" style="color: transparent"></input>
                </div>

                <div class="spacer" style="display: inline-block; width: 300px; height: 50px;"></div>
                <div class="row" style="">
                    <button class="button button-positive button-outline button-block" type="submit">Add document</button>
                </div>
            </form>
        </ion-content>
    </div>
</script>