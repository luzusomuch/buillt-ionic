<ion-view title="buiilt">
	
	<!-- Show config dialog. -->
    <!-- <ion-nav-buttons side="left">
        <button class="button button-clear icon-right ion-ios-person-outline" ng-click="showConfirm()" style="margin-left: 10px;"></button>
    </ion-nav-buttons> -->
	
	<!-- Add message thread or task. -->
    <ion-nav-buttons side="right" >
        <button ng-show="hasUpdate" class="button button-clear icon ion-ios-checkmark-empty" ng-click="doUpdate()"></button>
        <button ng-show="currentTab=='thread' || currentTab=='task' || currentTab=='file'" ng-hide="selectedProject.name == null" ng-click="openCreateThreadOrTaskModal()" class="button button-clear icon-right ion-ios-plus-empty" style="margin-right: 10px;"></button> 
    </ion-nav-buttons>
	
	<!-- Subheader bar with project name - show select project dialog -->
    <div class="bar bar-subheader" style="">
        <div class="button-bar">
            <a class="button button-clear button-calm" style="font-size: 12px; font-weight: 500" ng-click="chooseProject($event)">{{(selectedProject.name) ? selectedProject.name : 'PROJECT'}}</a>
        </div>
    </div>

	<!-- Main content view. -->
    <ion-content class="has-subheader">
	
		<div class="row" ng-show="selectedProject.name == null">
			<h5 style="margin-top: 30vh" class="col text-center">Select a project by clicking "Project" above...</h5>
		</div>
		
		<!-- When messages tab is selected. -->
	    <ion-nav-view ng-show="currentTab == 'thread'" name="Messages">
	        <div class="list" ng-show="currentTab == 'thread'">
	            <ion-item class="item-text-wrap" ng-repeat="thread in threads" ui-sref="threadDetail({threadId: thread._id})" ng-show="!thread.isArchive&&thread.__v > 0">
	                <span><h2><i class="icon calm ion-ios-circle-filled"></i> {{thread.name}}</h2></span>
                    <p>
                        <span ng-repeat="member in thread.members | unique: '_id' track by $index">{{member.name}}, </span>
                        <span ng-repeat="name in thread.notMemberNames track by $index">{{name}}, </span>
                    </p>
	            </ion-item>

                <ion-item class="item-text-wrap" ng-repeat="thread in threads | orderBy: '-updatedAt'" ui-sref="threadDetail({threadId: thread._id})" ng-show="!thread.isArchive&&thread.__v==0">
                    <h2>{{thread.name}}</h2>
                    <p>
                        <span ng-repeat="member in thread.members | unique: '_id' track by $index">{{member.name}}, </span>
                        <span ng-repeat="name in thread.notMemberNames track by $index">{{name}}, </span>
                    </p>
                </ion-item>
	        </div>
	    </ion-nav-view>
	
		<!-- When tasks tab is selected. -->
	    <ion-nav-view ng-show="currentTab == 'task'" name="Tasks">
	        <div class="list" ng-show="currentTab == 'task'">
	            <ion-item class="item-text-wrap" ng-repeat="task in tasks" ui-sref="taskDetail({taskId: task._id})" ng-show="task.__v > 0">
					<span><h2><i class="icon calm ion-ios-circle-filled"></i> {{task.description}}</h2></span>
                    <p>Due {{(task.dueDate) ? task.dueDate : task.dateEnd | date: 'dd/MM/yyyy'}}</p>
					<p>
                        <span ng-repeat="member in task.members | unique: '_id' track by $index">{{member.name}}, </span>
                        <span ng-repeat="name in task.notMemberNames track by $index">{{name}}, </span>
                    </p>
	            </ion-item>

                <ion-item class="item-text-wrap" ng-repeat="task in tasks" ui-sref="taskDetail({taskId: task._id})" ng-show="task.__v == 0 && !task.completed">
                    <h2>{{task.description}}</h2>
                    <p>Due {{(task.dueDate) ? task.dueDate : task.dateEnd | date: 'dd/MM/yyyy'}}</p>
					<p>
                        <span ng-repeat="member in task.members | unique: '_id' track by $index">{{member.name}}, </span>
                        <span ng-repeat="name in task.notMemberNames track by $index">{{name}}, </span>
                    </p>
                </ion-item>
	        </div>
	    </ion-nav-view>
	   
		<!-- when files tab is selected -->
        <ion-nav-view ng-show="currentTab == 'file'" name="Files">
            <div class="list" ng-show="currentTab=='file'">
                <ion-item class="item-text-wrap" ng-repeat="file in files" ui-sref="fileDetail({fileId: file._id})" ng-show="file.__v > 0">
					<span><h2><i class="icon calm ion-ios-circle-filled"></i> {{file.name}}</h2></span>
                    <p>
                        <span ng-repeat="member in file.members | unique: '_id' track by $index">{{member.name}}, </span>
                        <span ng-repeat="name in file.notMemberNames track by $index">{{name}}, </span>
                    </p>
                </ion-item>

                <ion-item class="item-text-wrap" ng-repeat="file in files" ui-sref="fileDetail({fileId: file._id})" ng-show="file.__v == 0">
                    <h2>{{file.name}}</h2>
                    <p>
                        <span ng-repeat="member in file.members | unique: '_id' track by $index">{{member.name}}, </span>
                        <span ng-repeat="name in file.notMemberNames track by $index">{{name}}, </span>
                    </p>
                </ion-item>
            </div>
        </ion-nav-view>

        <!-- when documents tab is selected -->
        <ion-nav-view ng-show="currentTab == 'document'" name="Documentations">
            <div class="list" ng-show="currentTab=='document'">
                <ion-item ui-sref="document.set({setId: set._id})" class="item-text-wrap" ng-repeat="set in documentSets">
                    <h2>{{set.name}}</h2>
                </ion-item>
            </div>
        </ion-nav-view>
		
	</ion-content>
	
	<!-- Tabs bar at bottom of list view screen. -->
    <ion-footer-bar>
        <ion-tabs class="tabs-icon-top tabs-light" style="margin-left:-5px">
			<!-- Tab for messages. -->
            <ion-tab ng-click="selectTabWithIndex(0)" title="Messages" icon="ion-ios-chatbubble calm" badge="selectedProject.element.thread" badge-style="badge-assertive"></ion-tab>
			<!-- Tab for tasks. -->
            <ion-tab ng-click="selectTabWithIndex(1)" title="Tasks" icon="ion-ios-checkmark calm" badge="selectedProject.element.task" badge-style="badge-assertive"></ion-tab>
            <!-- Tab for files. -->
            <ion-tab ng-click="selectTabWithIndex(2)" title="Files" icon="ion-ios-copy calm" badge="selectedProject.element.file" badge-style="badge-assertive"></ion-tab>
            <!-- Tab for documents. -->
            <ion-tab ng-click="selectTabWithIndex(3)" title="Documentation" icon="ion-ios-box calm" badge="selectedProject.element.document" badge-style="badge-assertive"></ion-tab>
			
        </ion-tabs>
    </ion-footer-bar>
		
</ion-view>

<script id="projectPopover.html" type="text/ng-template">
	<ion-popover-view>
		<ion-header-bar>
			<h1 class="title">Select a Project...</h1>
		</ion-header-bar>
		<ion-content>
            <ion-list ng-repeat="project in projects | unique:project">
                <ion-item ng-click="selectProject(project)">{{project.name}}<span ng-show="project.__v > 0"> ({{project.__v}}) </span></ion-item>
            </ion-list>
		</ion-content>
	</ion-popover-view>
</script>

<script id="modalCreateThread.html" type="text/ng-template">
    <div class="modal">
        <ion-header-bar class="bar-stable">
            <h1 class="title">Create a New Thread...</h1>
            <div class="buttons">
                <button ng-click="modalCreateThread.hide()" class="button button-stable button-icon icon ion-ios-close-empty"></button>
            </div>
        </ion-header-bar>
        
        <ion-content class="has-header padding">
        
            <form ng-submit="createNewThread(form)" ng-show="selectedProject._id" id="createTaskForm" name="form" novalidate>
                
                <div class="item item-input item-floating-label" ng-show="step==1" style="border-right: none; border-left: none; border-top: none; margin-top: 119px">
                    <span class="input-label">Thread Name</span>
                    <input placeholder="Thread Name" id="name" type="text" ng-model="thread.name" name="name" maxlength="300" required>
                </div>
                
                <div class="available-assign" ng-show="step==2">
                    <label class="item item-input item-stacked-label" style="border-right: none; border-left:none; border-top: none; border-bottom: none; margin-bottom: 15px">
                        <span class="input-label">Assignees:</span>
                    </label>
                    
                    <ion-list>
                        <ion-checkbox class="item item-checkbox checkbox-calm" ng-checked="staff.select" ng-repeat="staff in projectMembers track by $index" ng-click="assign($index)" style="border-left: none; border-right: none;">{{(staff.name) ? staff.name : staff.email}}</ion-checkbox>
                    </ion-list>
                </div>

                <div class="row">
                    <!-- <button type="button" class="button button-calm button-clear button-block" ng-click="step=step-1" ng-hide="step==1">Back</button> -->
                    <button type="button" class="button button-calm button-clear button-block" ng-click="next('create-thread')" ng-hide="step==2">Next</button>
                    <button type="submit" class="button button-calm button-clear button-block" ng-show="step==2">Create Thread</button>
                <div>
                
                <div class="space" style="height: 50px"></div>

            </form>
        </ion-content>
    </div>
</script>

<!-- Create file dialog. -->
<script id="modalCreateFile.html" type="text/ng-template">
    <div class="modal">
        <ion-header-bar class="bar-stable">
            <h1 class="title">Create a New File...</h1>
            <div class="buttons">
                <button ng-click="modalCreateFile.hide()" class="button button-stable button-icon icon ion-ios-close-empty"></button>
            </div>
        </ion-header-bar>
        
        <ion-content class="has-header padding">
        
            <form ng-submit="createNewFile(form)" ng-show="selectedProject._id" name="form" novalidate>
                
                <div class="item item-input item-floating-label" ng-show="step==1" style="border-right: none; border-left: none; border-top: none; margin-top: 100px">
                    <span class="input-label">File Name</span>
                    <input placeholder="File Name" type="text" ng-model="uploadFile.name" name="name" maxlength="300" required>
                </div>

                <div class="list" ng-show="step==1">
                    <label class="item item-input item-select" style="border-right: none; border-left:none; border-top: none; border-bottom: none; margin-top: 15px">
                        <div class="input-label">Tag</div>
                        <select ng-model="uploadFile.selectedTag">
                            <option ng-selected="file.selectedTag==tag.name" ng-repeat="tag in tags" ng-value="tag.name">{{tag.name}}</option>
                        </select>
                    </label>
                </div>
                
                <div class="available-assign" ng-show="step==2">
                    <label class="item item-input item-stacked-label" style="border-right: none; border-left:none; border-top: none; border-bottom: none; margin-bottom: 15px">
                        <span class="input-label">Assignees:</span>
                    </label>
                    
                    <ion-list>
                        <ion-checkbox class="item item-checkbox checkbox-calm" ng-checked="staff.select" ng-repeat="staff in projectMembers track by $index" ng-click="assign($index)" style="border-left: none; border-right: none;">{{(staff.name) ? staff.name : staff.email}}</ion-checkbox>
                    </ion-list>
                </div>

                <div ng-show="step==3">
                    <div class="item item-input" style="border-right: none; border-left: none; border-top: none; margin-top: 170px">
                        <input onchange="angular.element(this).scope().getFileUpload()" id="read-input" type="file" style="color: transparent"></input>
                    </div>
                </div>

                <div class="row">
                    <!-- <button type="button" class="button col" ng-click="step=step-1" ng-hide="step==1">Back</button> -->
                    <button type="button" class="button button-calm button-clear button-block" ng-click="next('create-file')" ng-hide="step==3">Next</button>
                    <button type="submit" class="button button-calm button-clear button-block" ng-show="step==3">Create File</button>
                <div>

            </form>
        </ion-content>
    </div>
</script>

<!-- Create task dialog. -->
<script id="modalCreateTask.html" type="text/ng-template">
    <div class="modal">
        <ion-header-bar class="bar-stable">
            <h1 class="title">Create a New Task...</h1>
            <div class="buttons">
                <button ng-click="closeModal('CreateTask')" class="button button-stable button-icon icon ion-ios-close-empty"></button>
            </div>
        </ion-header-bar>
		
        <ion-content class="has-header padding">
		
            <form ng-submit="createNewTask(form)" ng-show="selectedProject._id" id="createTaskForm" name="form" novalidate>
				
                <div class="item item-input item-floating-label" ng-show="step==1" style="border-right: none; border-left: none; border-top: none; margin-top: 129px">
					<span class="input-label">Task Description</span>
                    <input placeholder="Task Description" id="task_description" type="text" ng-model="task.description" name="description" maxlength="300" ng-class="{'invalid' : form.description.$invalid && submitted}" required>
                </div>

                <div class="item" ng-show="step==2" style="border-right: none; border-left:none; border-top: none; margin-top: 69px">
                    <label class="item item-input item-stacked-label" style="border-right: none; border-left:none; border-top: none; border-bottom: none; margin-bottom: 15px">
                        <span class="input-label">Task Start:</span>
                    </label>
                    <div ion-datetime-picker ng-model="task.dateStart" class="col" style="text-align: center"> {{task.dateStart| date: "dd MMMM yyyy H:mm"}} </div>
                </div>

                <div class="item" ng-show="step==2" style="border-right: none; border-left:none; border-top: none;">
                    <label class="item item-input item-stacked-label" style="border-right: none; border-left:none; border-top: none; border-bottom: none;  margin-bottom: 15px">
                        <span class="input-label">Task End:</span>
                    </label>
                    <div ion-datetime-picker ng-model="task.dateEnd" class="col" style="text-align: center"> {{task.dateEnd| date: "dd MMMM yyyy H:mm"}} </div>
                </div>
				
                <div class="available-assign" ng-show="step==3">
					<label class="item item-input item-stacked-label" style="border-right: none; border-left:none; border-top: none; border-bottom: none; margin-bottom: 15px">
					    <span class="input-label">Assignees:</span>
					</label>
					
					<ion-list>
						<ion-checkbox class="item item-checkbox checkbox-calm" ng-checked="staff.select" ng-repeat="staff in projectMembers track by $index" ng-click="assign($index)" style="border-left: none; border-right: none;">{{(staff.name) ? staff.name : staff.email}}</ion-checkbox>
					</ion-list>
                </div>

                <div class="row">
                    <!-- <button type="button" class="button col" ng-click="step=step-1" ng-hide="step==1">Back</button> -->
                    <button type="button" class="button button-calm button-clear button-block" ng-click="next('create-task')" ng-hide="step==3">Next</button>
                    <button type="submit" class="button button-calm button-clear button-block" ng-show="step==3">Create Task</button>
                <div>
				
                <div class="space" style="height: 50px"></div>

            </form>
        </ion-content>
    </div>
</script>

<!-- show create new team -->
<script id="modalCreateTeam.html" type="text/ng-template">
    <div class="modal">
        
        <!-- Header -->
        <ion-header-bar class="bar-stable">
            <h1 class="title">Create New Team...</h1>
            <div class="buttons">
                <button ng-click="modalCreateTeam.hide()" class="button button-stable button-icon icon ion-ios-close-empty"></button>
            </div>
        </ion-header-bar>
        
        <ion-content class="has-header padding">
        
            <form id="form" name="form" novalidate>

                <!-- Team Name -->
                <div class="item item-input item-floating-label">
                    <span class="input-label">Team Name:</span>
                    <input placeholder="Team Name" id="name" type="text" ng-model="newTeam.name" name="name" ng-class="{'invalid' : form.name.$invalid && submitted}" required ng-disabled="newTeam.type=='homeOwner'">
                    <p class="validate-message" style="color: #F44336" ng-show="form.name.$error.required && submitted">Team Name is required...</p>
                </div>

                <div class="available-assign">
                    <label class="item item-input item-stacked-label">
                        <span class="input-label">Team Type:</span>
                    </label>
                    
                    <ion-list>
                        <ion-radio ng-click="selectTeamType('homeOwner')">Home Owner</ion-radio>
                        <ion-radio ng-click="selectTeamType('builder')">Builder</ion-radio>
                        <ion-radio ng-click="selectTeamType('architect')">Architect</ion-radio>
                        <ion-radio ng-click="selectTeamType('contractor')">Subcontractor</ion-radio>
                        <ion-radio ng-click="selectTeamType('consultant')">Consultant</ion-radio>
                    </ion-list>
                </div>

                <div style="color: red; margin-left: 20px;" ng-show="error.team">{{error.team}}</div>
                
                <div class="space" style="height: 50px"></div>   
            </form>


        </ion-content>

        
        <div class="space" style="height: 50px"></div>

        <div class="bar bar-footer bar-calm">
          <div class="title" style="cursor:pointer" ng-click="createTeam()">Create Team</div>
        </div>
        
    </div>
</script>