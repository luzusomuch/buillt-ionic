<div class="row" style="margin-top: 18px">
  <h5 class="col s8">Contractor Package {{contractorRequest.name}} in Tender</h5>
  <div class="col s4" style="margin-top:15px">
   <a class='dropdown-button btn-flat right tooltipped' dropdown data-position="top" data-delay="1" data-tooltip="Attach..." data-gutter="-16"
      data-activates='itemActions' dropdown data-beloworigin="true" data-constrainwidth="false" >
    <i class="mdi-navigation-more-vert"></i>
  </a>

  <!-- Dropdown Structure -->
  <ul id='itemActions' class='dropdown-content left'>
   <li><a class="modal-trigger" href="#modal_attachAddendum">Attach Addendum</a></li>
   <li><a class="modal-trigger" href="#modal_inviteContractor">Invite Contractor</a></li>
   <li><div class="divider"></div></li>
   <li><a ng-click="cancelPackage()">Cancel Package</a></li>
 </ul>
</div>

<div class="row">
 <p class="col s12">{{contractorRequest.description}}</p>
</div>

<div class="row" ng-if="contractorRequest.winnerTeam._id" style="display:none">
  <div class="col s12">
    <ul class="collapsible" data-collapsible="accordion">
      <li>
        <div class="collapsible-header">
          Team {{contractorRequest.winnerTeam.name}} has won this package.
        </div>
        <div class="collapsible-body">
          <div class="row">
          <div class="col s5">
            <p>This is the detail area for the winner tender.</p>
            <p>
              Price <strong>{{contractorRequest.quote}}</strong>
            </p>
            <p>{{contractorRequest.description}}</p>
          </div>
          <div class="col s6">
             <ul class="collection">
               <div style="height: 300px; background-color: white; overflow-y : auto">

                 <li class="collection-item" ng-repeat = "message in messages.messages">
                   <div class="row valign-wrapper" style="margin-bottom: -5px">
                     <a class="btn-flat col s1">
                       <i class="mdi-toggle-radio-button-on valign center-align" ></i>
                     </a>

                     <p class="col s19 valign">{{message.message}}</p>
                     <p class="circle col s2 right valign center-align"><strong>Sent by</strong>: {{message.sendBy.name}}</p>
                   </div>
                 </li>
               </div>
               <div class="divider"></div>
               <div class="col s12 card-footer" style="background-color: white">
                 <div class="row">
                   <form class="valign-wrapper" ng-submit="sendMessage()">
                     <div class="input-field col s9">
                       <textarea id="textarea1" class="materialize-textarea" ng-model="message.message"></textarea>
                       <label for="textarea1">Textarea</label>
                     </div>
                     <div class="col s3">
                       <button class="btn-flat btn-flat valign" type="submit" name="action">
                         Send
                       </button>
                     </div>
                   </form>
                 </div>
               </div>
             </ul>
           </div>
        </div>
        </div>
      </li>
    </ul>
  </div>
</div>

<div class="row" ng-if="!contractorRequest.winnerTeam._id">
  <div class="col s12">
    <ul class="collapsible" data-collapsible="accordion">
      <li>
        <div class="collapsible-header">
          Detail
        </div>
        <div class="collapsible-body" style="background-color: #FFF; padding:10px">
          <strong>Start date</strong>: {{contractorRequest.dateStart | date: longDate}}
          <table>
            <thead>
              <th>Description</th>
            </thead>
            <tbody>
              <tr ng-repeat="addendum in contractorRequest.addendums | filter:{isHidden:false}">
                <td>{{addendum.addendumsScope.description}}</td>
              </tr>
            </tbody>
          </table>
        </div>
      </li>
    </ul>
  </div>
  <div class="col s12">
    <ul class="collapsible" data-collapsible="accordion">
      <li ng-repeat="toContractor in contractorRequest.to | filter: {isDecline:false}">
        <div class="collapsible-header">
          Tenderer #{{$index+1}} - {{toContractor.email}}
          <a ng-if="toContractor.quote._id" class="btn-flat btn-flat secondary-content modal-trigger" href='#modal_viewQuote_{{toContractor.quote._id}}' style="font-size:12px; margin-top: 8px">View Quote</a>
        </div>
        <div class="collapsible-body" style="background-color: #FFF; padding:10px">
          <div class="row">
            <div class="col s12 m5">
              Detail for the tender #{{$index + 1}}.
              <div ng-repeat="file in files" ng-if="toContractor.team == file.uploadBy">
                {{file.title}} - <a href='{{file.fileUrl}}' download="file.name">Download file</a>
              </div>
              <div ng-if="toContractor.quote.total > 0" style="text-align:center">
                Total: {{toContractor.quote.total}}
              </div>
              <div ng-if="toContractor.quote._id">
                <a style="margin: 0px -15px;" class="btn-flat btn-flat modal-trigger" href="#modal_viewQuote_{{toContractor.quote._id}}">View quote</a>
                <button style="margin: 0px -15px;" ng-click="selectQuote(toContractor.quote._id)" class="btn-flat btn-flat valign">Select quote</button>
                <button style="margin: 0px -15px;" ng-click="declineQuote(toContractor._id)" class="btn-flat btn-flat valign">Decline quote</button>
              </div>
            </div>
            <div class="col s12 m6">
             <ul class="collection">
               <div style="height: 300px; background-color: white; overflow-y:auto">
                 <li class="collection-item" ng-repeat = "message in messages.messages" ng-if="message.to == toContractor._id">
                   <div class="row valign-wrapper" style="margin-bottom: -5px" >
                     <a class="btn-flat col s1">
                       <i class="mdi-toggle-radio-button-on valign center-align" ></i>
                     </a>
                     <p class="col s7 valign">{{message.message}}</p>
                     <p class="circle col s4 right valign center-align"><strong>Sent by</strong>: {{message.sendBy.name}}</p>
                   </div>
                 </li>
               </div>
               <div class="divider"></div>
               <div class="col s12 card-footer" style="background-color: white">
                 <div class="row">
                   <form class="valign-wrapper" ng-submit="sendMessage(toContractor._id)">
                     <div class="input-field col s7 m9">
                       <textarea id="textarea1" class="materialize-textarea" ng-model="message.message"></textarea>
                       <label for="textarea1">Textarea</label>
                     </div>
                     <div class="col s3 m3">
                       <button class="btn-flat btn-flat valign" type="submit" name="action">
                         Send
                       </button>
                     </div>
                   </form>
                 </div>
               </div>
             </ul>
           </div>
          </div>
        </div>
      </li>
    </ul>
  </div>

<div ng-repeat="quoteRequest in quoteRequests">
  <div id='modal_viewQuote_{{quoteRequest._id}}' class="modal modal-fixed-footer">
    <div class="modal-content">
      <h4>View Quote</h4>
      <p ng-show="quoteRequest.total > 0">Total: <strong>{{quoteRequest.total}}</strong></p>
      <p>{{quoteRequest.description}}</p>
      <div>
        <table>
          <thead>
            <th>#</th>
            <th>Description</th>
            <th>Rate</th>
            <th>Quantity</th>
            <th>Total</th>
          </thead>
          <tbody>
            <tr ng-repeat="quoteRate in quoteRequest.quoteRate">
              <td>{{$index +1}}</td>
              <td>{{quoteRate.description}}</td>
              <td>{{quoteRate.rate}}</td>
              <td>{{quoteRate.quantity}}</td>
              <td>{{quoteRate.total}}</td>
            </tr>
            <tr ng-repeat="quotePrice in quoteRequest.quotePrice">
              <td>{{$index +1}}</td>
              <td>{{quotePrice.description}}</td>
              <td>{{quotePrice.price}}</td>
              <td>{{quotePrice.quantity}}</td>
              <td>{{quotePrice.total}}</td>
            </tr>
          </tbody>
        </table>
      </div>
    </div>
    <div class="modal-footer">
      <a ng-click="selectQuote(quoteRequest._id)" class="modal-action modal-close waves-effect waves-green btn-flat ">Select this quote</a>
      <a class="modal-action modal-close waves-effect waves-green btn-flat " ng-click="declineQuote(quoteRequest.team)">Decline</a>
      <a class="modal-action modal-close waves-effect waves-green btn-flat ">Close</a>
    </div>
  </div>
</div>

<div id="modal_inviteContractor" class="modal modal-fixed-footer">
  <form ng-submit="sendInvitationInContractor()" name="form">
  <div class="modal-content">
    <form>
     <div class="row">
       <div class="col s12">
         <h5>Invite More Sub-Contractors to Package {{contractorRequest.name}}</h5>
       </div>
     </div>

     <div class="row">
       <div class="col s12">
        <ul class="collection z-depth-1">
          <li class="collection-item vlalign-wrapper">
            <div class="row form" style="margin-bottom: 0px">
              <div class="col s12"><p>Enter tradesmen's details below:</p></div>
              <div class="input-field col s12 m7">
                <input id="email_address" type="email" class="validate" ng-model="user.newEmail">
                <label for="email_address">Email</label>
              </div>
              <div class="input-field col s6 m3">
                <input id="phone_number" type="number" name="phoneNumber" class="validate" ng-model="user.newPhoneNumber">
                <label for="phone_number">Phone Number</label>
                <p class="validate-message" ng-if="form.phoneNumber.$valid == false">Please input number</p>
              </div>
              <div class="valign col s6 m2">
                <a ng-if="form.phoneNumber.$valid == true" ng-click="addUser()" class="btn" style="margin-top: 28px">Add</a>
              </div>
            </div>
          </li>
          <li class="collection-item vlalign" ng-repeat="emailPhone in emailsPhone">
            <div class="row" style="margin-bottom: 0px">
              <div class="col s12 m7">{{emailPhone.email}}</div>
              <div class="col s6 m3">{{emailPhone.phoneNumber}}</div>
              <div class="col s6 m2" style="float:right"><a class="btn-flat btn-flat" ng-click="removeUser($index)" >Remove</a></div>
            </div>
          </li>
        </ul>
      </div>
    </div>

</div>
<div class="divider"></div>
<div class="modal-footer">
  <button type="submit" class="modal-action modal-close waves-effect waves-green btn-flat ">Send Invitations!</button>
 <!-- <a class="modal-action modal-close waves-effect waves-green btn-flat ">Send Invitations!</a> -->
 <a class="modal-action modal-close waves-effect waves-green btn-flat ">Cancel</a>
</div>
</form>
</div>  

<div id="modal_cancelPackage" class="modal">
  <div class="modal-content">
   <div class="row">
     <div class="col s12">
       <h5>Confirm the Cancelation of Package {{contractorRequest.name}}</h5>
     </div>
   </div>
   <div class="divider"></div>
   <div class="modal-footer">
     <a class="modal-action modal-close waves-effect waves-green btn-flat ">Cancel This Package</a>
     <a class="modal-action modal-close waves-effect waves-green btn-flat ">Go Back</a>
   </div>
 </div>  
</div>
<addendum package="contractorRequest" type="contractor"></addendum>

